<!doctype html> 
<html lang="en"> 
<head> 
    <meta charset="UTF-8" />
    <title>Making your first Phaser 3 Game - Part 10</title>
    <script src="//cdn.jsdelivr.net/npm/phaser@3.11.0/dist/phaser.js"></script>
    <style type="text/css">
        body {
            margin: 0;
        }
    </style>
</head>
<body>

<script type="text/javascript">

var config = {
    type: Phaser.AUTO,
    width: 800,
    height: 600,
    physics: {
        default: 'arcade',
        arcade: {
            debug: false
        }
    },
    scene: {
        preload: preload,
        create: create,
        update: update
    }
    
};

const width  = window.innerWidth || document.documentElement.clientWidth || document.body.clientWidth;
const height = window.innerHeight|| document.documentElement.clientHeight|| document.body.clientHeight;
var player;
var player2;
var ball;
var background;
var cursors;
var score = 0;
var score2 = 0;
var gameOver = false;
var scoreText

var game = new Phaser.Game(config);

function preload ()
{
    this.load.image('background', 'assets/background.jpg');
    this.load.image('paddle', 'assets/paddle.png');
    this.load.image('ball', 'assets/ball.png');
    this.load.image('bomb', 'assets/bomb.png');
}

function create ()
{
    //  A simple background for our game
    //platforms.create(400, 568, 'ground').setScale(2).refreshBody();
    //game.physics.setBoundsToWorld();
    //  The platforms group contains the ground and the 2 ledges we can jump on
    background = this.physics.add.image(width/2, height/2, 'background');
    background.setScale(width);
    //  Here we create the ground.
    //  Scale it to fit the width of the game (the original sprite is 400x32 in size)
    //platforms.create(400, 568, 'paddle').setScale(2).refreshBody();

    //  Now let's create some ledges

    // The player and its settings
    player = this.physics.add.image(width/12, height/2, 'paddle');
    player.setScale(height/3/player.height);
    player2 = this.physics.add.image(width-(width/12), height/2, 'paddle');
    player2.setScale(height/3/this.height);
    ball = this.physics.add.image(width/2, height/2, 'ball');
    ball.setScale(height/9/ball.height);
    //  Input Events
    cursors = this.input.keyboard.createCursorKeys();

    //  The score
    scoreText = this.add.text(16, 16, 'score: 0:0', { fontSize: '32px', fill: '#ffffff' });

    //  Collide the player and the stars with the platforms
    this.physics.add.collider(ball, player, ballOut, null, this);
    this.physics.add.collider(ball, player2, ballOut, null, this);
    //this.input.keyboard.on('keydown_W', w, player2)
    //this.input.keyboard.on('keydown_S', s, player2)

    //  Checks to see if the player overlaps with any of the stars, if he does call the collectStar function
    //this.physics.add.overlap(0, ball, p2Score, null, this);
    //this.physics.add.overlap(600, ball, p1Score, null, this);
    ball.setVelocityX(-160);
    ball.setVelocityY(-80);
    //ball.events.onOutOfBounds.add(ballOut(), this);
}

function update ()
{
    if (gameOver)
    {
        return;
    }

    if (cursors.up.isDown)
    {
        player.setVelocityY(-160);
    }
    else if (cursors.down.isDown)
    {
        player.setVelocityY(160);
    }
    else
    {
        player.setVelocityY(0);
    }
    // this.input.keyboard.on('keydown', (event) => {
    //     if (/*!keys.has(event.code)*/event ==='keydown_W') {
    //         /*keys.add(event.code);
    //         this.input.keyboard.emit(`keypress_${event.code}`);
    //         // or / and
    //         this.input.keyboard.emit(`keypress`, event.code);
    //         */
    //        player2.setVelocityY(-160);
    //     } else if(event ==='keydown_S'){
    //         player2.setVelocityY(160);
    //     } else{
    //         player2.setVelocityY(0);
    //     }
    // });
    if(ball.y>player2.y){
        player2.setVelocityY(160);
    }else if(ball.y<player2.y){
        player2.setVelocityY(-160);
    }else{
        player2.setVelocityY(0);
    }

    // code = this.event.KeyCodes;
    // if (Phaser.Input.Keyboard.KeyCodes.W===code)
    // {
    //     player2.setVelocityY(-160);
    // }
    // else if (Phaser.Input.Keyboard.KeyCodes.S===code)
    // {
    //     player2.setVelocityY(160);
    // }
    // else
    // {
    //     player2.setVelocityY(0);
    // }

    //player2.setVelocityY(0);
    // if(ball.x === player.x&&ball.y==player.y){
    //     ball.setVelocityX(-1*ball.getVelocityX());
    //     ball.setVelocityY(-1*ball.getVelocityY());
    // }
    // if(ball.x === player2.x&&ball.y==player2.y){
    //     ball.setVelocityX(-1*ball.getVelocityX());
    //     ball.setVelocityY(-1*ball.getVelocityY());
    // }
    if(ball.x <= 0){
        ball.setVelocityX(80);
        score2++;
        scored();
    }
    if(ball.x >= width){
        ball.setVelocityX(-80);
        score++;
        scored();
    }
    if(ball.y <= 0||ball.y>=height){
        if(ball.y<=0){
            ball.setVelocityY(80);
        }else{
            ball.setVelocityY(-80);
        }
    }
    if(player.y<=0){
        player.y = player.y+160;
    }
    if(player.y>=height){
        player.y = player.y-160;
    }
    if(player2.y<=0){
        player2.y = player2.y+160;
    }
    if(player2.y>=height){
        player2.y = player2.y-160;
    }
}

function scored ()
{
    //  Add and update the score
    scoreText.setText('Score: ' + score+':'+score2);

    if (score === 7||score2===7)
    {
        //  A new batch of stars to collect
        if(score === 7){
            scoreText.setText(width/2, height/2, 'player1 wins', { fontSize: '100px', fill: '#ffffff' });
        }
        if(score2 === 7){
            scoreText.setText(width/2, height/2, 'player2 wins', { fontSize: '100px', fill: '#ffffff' });
        }
        gameOver === true;
    }else{
        ball.x = width/2;
        ball.y = height/2;// = this.physics.add.image(400, 300, 'ball');   
    }
    
}

function w (){
    player2.setVelocityY(-160);
}

function s (){
    player2.setVelocityY(160);
}
function ballOut(){
    if(ball.x<width/2){
        ball.setVelocityX(80); 
    }
    player2.x = width-(width/12);
    player2.setVelocityX(0);
    if(ball.x>width/2){
        ball.setVelocityX(-80); 
    }
    player.x=width/12;
    player.setVelocityX(0);
    if(ball.x<0){
        score2++;
        scored();
    }
    if(ball.x>width){
        score++;
        scored();
    }
}
</script>

</body>
</html>